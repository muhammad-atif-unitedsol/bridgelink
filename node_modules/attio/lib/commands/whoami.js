import { Command } from "commander";
import { isErrored } from "@attio/fetchable-npm";
import { api } from "../api/api.js";
import { getKeychain } from "../auth/keychain.js";
import { printFetcherError } from "../print-errors.js";
export const whoami = new Command()
    .name("whoami")
    .description("Identify the current user")
    .action(async () => {
    const tokenResult = await getKeychain().load();
    if (isErrored(tokenResult) || tokenResult.value === null) {
        process.stdout.write("ðŸ”’ Not logged in.\n");
        process.exit(0);
    }
    const result = await api.whoami();
    if (isErrored(result)) {
        printFetcherError("Error fetching user", result.error);
        process.exit(1);
    }
    const { name, email_address } = result.value;
    process.stdout.write(`ðŸ‘¤ ${name.full} (${email_address})\n`);
    process.exit(0);
});
