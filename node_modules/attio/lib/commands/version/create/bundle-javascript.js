import { complete, errored, isErrored } from "@attio/fetchable-npm";
import { prepareBuildContext } from "../../dev/prepare-build-context.js";
export async function bundleJavaScript() {
    const buildContextResult = await prepareBuildContext("in-memory");
    if (isErrored(buildContextResult)) {
        return errored({
            code: "ERROR_PREPARING_BUILD_CONTEXT",
            error: buildContextResult.error,
        });
    }
    const buildContext = buildContextResult.value;
    const results = await buildContext.rebuild();
    if (isErrored(results)) {
        return errored({
            code: "ERROR_BUILDING_BUNDLE",
            error: results.error,
        });
    }
    const builds = results.value;
    const disposeResult = await buildContext.dispose(1_000);
    if (isErrored(disposeResult)) {
        return errored({
            code: "ERROR_DISPOSING_BUILD_CONTEXT",
            error: disposeResult.error,
        });
    }
    return complete([builds.client.outputFiles[0].text, builds.server.outputFiles[0].text]);
}
