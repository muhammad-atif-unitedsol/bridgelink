import { readFileSync } from "fs";
import { join } from "path";
import { z } from "zod";
import { complete, errored } from "@attio/fetchable-npm";
const packageJsonSchema = z.object({
    name: z.string({
        required_error: "No name field found in package.json",
        invalid_type_error: `"name" must be a string in package.json`,
    }),
});
export async function getAppSlugFromPackageJson() {
    try {
        const packageJsonPath = join(process.cwd(), "package.json");
        const packageJsonRaw = JSON.parse(readFileSync(packageJsonPath, "utf8"));
        const result = packageJsonSchema.safeParse(packageJsonRaw);
        if (!result.success) {
            return errored({ code: "MALFORMED_PACKAGE_JSON", error: result.error });
        }
        return complete(result.data.name);
    }
    catch (error) {
        if (error instanceof SyntaxError) {
            return errored({ code: "INVALID_JSON", error });
        }
        return errored({ code: "FILE_SYSTEM_ERROR", error });
    }
}
