import fs from "fs/promises";
import path from "path";
import { complete, errored } from "@attio/fetchable-npm";
import { HIDDEN_ATTIO_DIRECTORY } from "../constants/hidden-attio-directory.js";
import { SETTINGS_TYPES_FILENAME } from "../constants/settings-files.js";
const SETTINGS_TYPES_FILE_CONTENT = `import "attio"

import type appSettingsSchema from "../src/app.settings"

declare module "attio" {
    export interface AppSettingsSchema {
        workspace: (typeof appSettingsSchema)["workspace"]
    }
}
`;
export async function generateSettingsTypes() {
    const rootDirAbsolute = path.resolve(".");
    const hiddenDirectoryPath = path.join(rootDirAbsolute, HIDDEN_ATTIO_DIRECTORY);
    const settingsTypesFilePath = path.join(hiddenDirectoryPath, SETTINGS_TYPES_FILENAME);
    try {
        await fs.mkdir(hiddenDirectoryPath, { recursive: true });
        await fs.writeFile(settingsTypesFilePath, SETTINGS_TYPES_FILE_CONTENT);
        return complete(undefined);
    }
    catch {
        return errored({ code: "FAILED_TO_CREATE_SETTINGS_TYPES_FILE" });
    }
}
