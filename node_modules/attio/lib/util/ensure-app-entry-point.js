import path from "path";
import readline from "readline/promises";
import { complete, errored, isErrored } from "@attio/fetchable-npm";
import { generateAppEntryPoint } from "./generate-app-entry-point.js";
import { getAppEntryPoint } from "./get-app-entry-point.js";
export async function ensureAppEntryPoint(promptToGenerate = false) {
    const srcDirAbsolute = path.resolve("src");
    const appEntryPoint = await getAppEntryPoint(srcDirAbsolute);
    if (appEntryPoint !== null) {
        return complete(true);
    }
    if (!promptToGenerate) {
        return errored({
            code: "APP_ENTRY_POINT_NOT_FOUND",
        });
    }
    let readlineInterface = readline.createInterface({
        input: process.stdin,
        output: process.stdout,
    });
    await readlineInterface.question("Could not find app.ts entry point. Press Enter to generate it...");
    readlineInterface.close();
    const generateResult = await generateAppEntryPoint(srcDirAbsolute);
    if (isErrored(generateResult)) {
        return errored({
            code: "FAILED_TO_GENERATE_ENTRY_POINT",
        });
    }
    return complete(true);
}
